---
title: "Use Findex and IFC FAS data to inform cash transfer options"
output: html_notebook
---

The [Findex dataset](https://globalfindex.worldbank.org/) contains data on saving, borrowing, and other financial behavior for over 140 countries.  The IFC's [Financial Access Survey dataset]() contains data on banking and other financial infrastructure (such as the total number of banks in a country) for 189 countries.  These datasets may help guide 

--> Add a bit more about the types of analyses we could do

```{r setup, results='hide'}
# Load libraries and set paths
library(tidyverse)
library(gt)
library(writexl)
data_path <- "C:/Users/dougj/Dropbox/Covid Social Protection/Data"

load(file.path(data_path, "Clean", "fdx_fas_latest.rda"))

```

Create a basic table of just the most important variables for just SE Asia

```{r}
seasia <- merged %>% select(country.x, ccode,
          `fdx_Account (% age 15+)`,
          `fdx_Account, rural (% age 15+)`,
          `fdx_No account because financial institutions are too far away (% age 15+)`,
          `fdx_Sent or received domestic remittances in the past year (% age 15+)`,
          `fdx_Sent or received domestic remittances in the past year, rural  (% age 15+)`,
          `fdx_Has a national identity card (% age 15+)`,
          `fdx_Mobile money account (% age 15+)`,
          `fdx_Mobile money account, rural  (% age 15+)`,
          ifc_i_branches_A1_km2,
          ifc_i_branches_A2_km2,
          ifc_i_branches_A3B1a_km2,
          ifc_i_branches_A1_pop,
          ifc_i_branches_A2_pop,
          ifc_i_branches_A3B1a_pop,
          ifc_i_ATMs_km2,
          ifc_i_ATMs_pop,
          ifc_i_mob_agent_active_pop,
          ifc_i_mob_agent_active_km2,
          ifc_i_mob_agent_registered_pop,
          ifc_i_mob_agent_registered_km2,
          ifc_i_nonbranch_A1_km2,
          ifc_i_nonbranch_A1_pop,
          region,
          income_level) %>% filter(region == "East Asia & Pacific (excluding high income)") %>% 
          filter((ccode != "MNG") & (ccode != "CHN"))

write_xlsx(seasia, path = file.path(data_path, "Clean", "SE Asia banking infra.xlsx"))

```



```{r, echo = FALSE}
fdxfas <- merged %>% transmute(country = country.x, ccode = ccode,
          fdx_has_account  = `fdx_Account (% age 15+)`,
          fdx_has_account_rural  = `fdx_Account, rural (% age 15+)`,
          fdx_has_fin_account  = `fdx_Financial institution account (% age 15+)`,
          fdx_has_fin_account_rural  = `fdx_Financial institution account, rural(% age 15+)`,
          fdx_fin_too_far  = `fdx_No account because financial institutions are too far away (% age 15+)`,
          fdx_remit  = `fdx_Sent or received domestic remittances in the past year (% age 15+)`,
          fdx_remit_rural  = `fdx_Sent or received domestic remittances in the past year, rural  (% age 15+)`,
          fdx_receive_govt_transfer  = `fdx_Received government transfers: into an account (% age 15+)`,
          fdx_has_id  = `fdx_Has a national identity card (% age 15+)`,
          fdx_no_txn  = `fdx_No deposit and no withdrawal from a financial institution account in the past year (% age 15+)`,
          fdx_has_mobile_account  = `fdx_Mobile money account (% age 15+)`,
          fdx_has_mobile_account_rural  = `fdx_Mobile money account, rural  (% age 15+)`,
          ifc_s_ATMs,
          ifc_s_mob_agent_active,
          ifc_s_mob_agent_registered,
          ifc_s_mob_acc_active,
          ifc_s_mob_acc_registered,
          ifc_i_branches_A1_km2,
          ifc_i_branches_A2_km2,
          ifc_i_branches_A3B1a_km2,
          ifc_i_branches_A1_pop,
          ifc_i_branches_A2_pop,
          ifc_i_branches_A3B1a_pop,
          ifc_i_ATMs_km2,
          ifc_i_ATMs_pop,
          ifc_i_mob_agent_active_pop,
          ifc_i_mob_agent_active_km2,
          ifc_i_mob_agent_registered_pop,
          ifc_i_mob_agent_registered_km2,
          ifc_i_nonbranch_A1_km2,
          ifc_i_nonbranch_A1_pop,
          ifc_i_mob_acc_registered_pop,
          ifc_i_mob_acc_active_pop,
          region,
          income_level)

# Display a table of each variable and its label (for those variables with labels)
vars <- colnames(fdxfas)
getlabel <- function(x) attributes(fdxfas[[x]])$label
labels <- map(vars, .f = getlabel)
vars <- tibble(Variable = colnames(fdxfas), Label = labels) %>% filter(Label != "NULL")
gt(vars) %>% tab_header(title = "Variable names and labels")

```






