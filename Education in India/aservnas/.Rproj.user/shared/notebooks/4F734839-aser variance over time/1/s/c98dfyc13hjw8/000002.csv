"0","# Create variable for year on year change for each district"
"0","state_deltas <- states %>% "
"0","  group_by(State) %>% "
"0","  mutate(delta_reading = std3_reading - lag(std3_reading, order_by = year), delta_math = std3_math - lag(std3_math, order_by = year)) %>%"
"0","  mutate(delta_reading_lagged = lag(delta_reading, order_by = year), delta_reading_dbl_lag = lag(delta_reading,n=2, order_by = year)) %>%"
"0","  arrange(State, year)"
"0",""
"0",""
"0","# Calculate average autocorrelation of delta_reading"
"0","corr_state_deltas <- state_deltas %>% "
"0","  filter(year >= 2008) %>% "
"0","  summarise(auto = cor(delta_reading, delta_reading_lagged, use = ""pairwise.complete.obs"")) %>%"
"0","  ungroup() %>%"
"0","  summarise(mean_auto=mean(auto)) %>% .$mean_auto"
"0",""
"0","# Calculate correlation betwen delta letters and delta letters lagged for entire dataset (without first calculating for each state and then averaging)."
"0","# this should be about the same as when we first calculate for each state and then average --> which it is."
"0","check_corr_state_deltas <- state_deltas %>% filter(year >= 2008) %>%"
"0","  ungroup() %>%"
"0","  summarize(auto =cor(delta_reading,delta_reading_lagged, use = ""pairwise.complete.obs"")) %>%"
"0","  .$auto"
"0",""
"0",""
"0","# calculate the variance of the deltas"
"0","var_state_deltas <- var(state_deltas$delta_reading/100, na.rm = TRUE)"
"0",""
"0","# calculate the variance of the levels"
"0","var_state_levels <- var(state_deltas$std3_reading/100, na.rm = TRUE)"
"0",""
"0","# calculate variance of transitory component"
"0","var_state_epsilon <- -corr_state_deltas*var_state_deltas"
"0",""
