---
title: "Private schools descriptive stats"
output: html_notebook
---

This notebook calculates basic descriptive statistics on private school enrolment and learning outcomes of private school students using ASER state-level data and IHDS data.  In particular, I calculate:

1. Enrolment (broken up by gender) and learning outcomes by sector for country from 2006-2014 (using ASER)
2. Enrolment and learning outcomes by sector for each state from 2006-2014 (using ASER)
3. Trends in learning outcomes and private sector enrolment for a few random districts
4. Jitter plots of various district variaÌ¥bles grouped by state


## Data 
### ASER state level data
Most of the analyses in this notebook are based on the ASER trends over time report.  The ASER Trends over Time report includes ASER figures by state (and for the country as a whole) for the years 2006 to 2014.  In particular, it includes the following data for the overall country and each state:

* Proportion boys, girls, and all children 6-14 enrolled in private school 
* Proportion of boys, girls, and all children 6-14 not enrolled in any school
* Proportion 3rd graders who can read std 1 text by govt / private
* Proportion 5th graders who can read std 2 text by govt / private
* Proportion 3rd graders who do subtraction by govt / private
* Proportion 5th graders who do division text by govt / private

It also includes some data on English attainment for years 2007, 2009, 2012, adn 2014 but I haven't yet processed and imported this data.

### ASER district level data
We use ASER data from the ASER district pages from years 2006 to 2011.  These are the only years for which ASER has publicly released district level data (to my knowledge).  There are four learning outcomes variables which all of these district pages include:

* Share class 1 and 2 students who can at least read letters
* Share class 1 and 2 students who can at least recognize numbers
* Share class 3, 4, and 5 students who can at least read level 1 text
* Share class 3, 4, and 5 students who can at least do subtraction


```{r setup, results = 'hide'}
library(tidyverse)
library(broom)
data_path <- "C:/Users/dougj/Documents/Data/Education"
output <- "C:/Users/dougj/Dropbox/Education in India/Original research/Private schools/output"
states <- read_csv(file.path(data_path, "ASER trends over time", "aser_trends.csv"))
country <- read_csv(file.path(data_path, "ASER trends over time", "aser_trends_national.csv")) 
dists <- read_csv(file.path(data_path, "ASER District Data/Clean", "aser_district_5_or_6.csv"))

```

## National trends
Graph enrolment and learning outcomes over time for the entire country.

Key takeaways include:

1. Across grades and subjects, private school students outperform government school students
2. Overall, the gap between the sectors grew quite a bit
3. There was a big decline in math scores in both sectors (but a larger decline in govt schools) in this period. (Very unclear what is going on here. Definitely not due to increasing enrolment. More recent ASER data shows a slight increase in the years between 2014 and 2018 but not enough to make up for losses. ASER folks also speculate whether it could be due to RTE.)
4. The difference in private school enrolment between boys and girls has increased from about 5 ppts to 15 ppts.

```{r}
country_long <- country %>% 
  pivot_longer(cols = starts_with("std"), names_to = "subject_year", values_to = "proportion") %>% 
  mutate(grade = str_extract(subject_year, "\\d"), 
         sector = str_extract(subject_year, "(govt)|(pvt)|(all)"),
         subject = str_extract(subject_year, "(read)|(subtract)|(divis)")) 

country_long$subject <- recode(country_long$subject, "subtract" = "math", "divis" = "math", "read"= "reading")

ggplot(country_long, aes(x = year, y = proportion, group = sector, colour = sector)) +
  geom_line() + geom_point() +
  facet_grid(subject ~ grade)

country_enrol <- country %>% 
  select(-pvt) %>% 
  pivot_longer(cols = starts_with("pvt"), names_to = "gender", values_to = "proportion")

ggplot(country_enrol, aes(x =year, y =proportion, group = gender, color = gender)) +
  geom_line() + geom_point()

```


## State trends

First look at private school enrolment and the difference between boys and girls private school enrolment for each state.  

Key takeaways:

1. Nearly all states (excep maybe Nagaland and Bihar) saw an increase in private school enrolment
2. A majority of states also saw an increased in the gender difference in private school enrolment


```{r}
ggplot(states, aes(x = year, y = pvt)) +
  geom_line() +
  theme(axis.text.x = element_blank())+
  facet_wrap( ~ state_abbr, nrow = 3)

# ggsave("state_enrolment.png", width = 20, height = 5, units = "cm", path = output)

ggplot(states, aes(x = year, y = pvt_boys-pvt_girls)) +
  geom_line() +
  theme(axis.text.x = element_blank())+
  facet_wrap( ~ state_abbr, nrow = 3)


```

Looks at trends in learning outcomes over time for states

Key takeawys:

1. There are some huge jumps in performance over time (especially MP, but also MH and ML)
2. Overall, private govt show similar trends
3. Difference between government and private varies quite a bit by state and over time

```{r}
# reshape to long
# drop states which don't have any data for grade 3. This frees up some space in the graph
states_long <- states %>% 
  filter(!is.na(std3_read_std1_pvt) & !is.na(std3_subtract_pvt)) %>% 
  select(state_abbr, year, starts_with("std")) %>%
  pivot_longer(cols = starts_with("std"), names_to = "series", values_to = "pct") %>% 
  mutate(grade = str_extract(series, "\\d"), 
         sector = str_extract(series, "(govt)|(pvt)|(all)"),
         subject = str_extract(series, "(read)|(subtract)|(divis)")) 

states_long$subject <- recode(states_long$subject, "subtract" = "math", "divis" = "math", "read"= "reading")

states_long_3 <- states_long %>% filter((grade == "3") & (sector != "all"))

ggplot(states_long_3, aes(x= year,  y = pct, group = sector, color = sector)) +
  geom_line() +
  facet_grid(subject ~ state_abbr) + 
  theme(axis.text.x = element_blank()) +
ggsave("state learning outcomes.png", width = 30, height = 10, units = "cm", path = output)
```

Create one last set of graphs showing math and reading scores for all students in 3rd grade for each state.  This is for the other paper on ASER and NAS data

```{r}

# Create graphs showing grade 3 reading and math levels over time

temp_ouput <- "C:/Users/dougj/Dropbox/Education in India/Original research/Learning outcomes data/figures"
for (s in c("math", "reading")) {
  df <- subset(states_long, subset = (grade ==3) & (sector == "all") & (subject == s))
  p <- ggplot(df, aes(x = year, y = pct)) + geom_line() +
  theme(axis.text.x = element_blank())+
  facet_wrap( ~ state_abbr, nrow = 3) +
  labs(title = paste("Grade 3", s, "levels"))
  print(p)
  ggsave(paste("state grade 3", s, "over time.png"),path = temp_ouput)
}
```


## District trends

Look at latest private enrolment, increase in private enrolment, latest learning outcome, and increase in learning outcome for each district, grouped by state.

Key takeaways:

1. There quite a bit of heterogeneity in 2011 private school enrolment in most states though there are a few states (e.g. Odisha and Bihar) which have uniformly low levels of private school enrolment. 
2. There appears to be more variance within states than across states when it comes to changes in private school enrolment.

```{r}
# Create vector for the variables I want to look at
vars <- c("private_6_14", "std12_letters_and_up", "std12_numbers_and_up", "std35_std1_and_up", "std35_subtraction_and_up")


# For some of the variables, I just want to look at their most recent values in 2011.
levels <- dists %>% filter(year == 2011)

# Create function to pass to mutate_at
first_diff <- function (x) {
  x - lag(x)
}

# Create a dataframe with the value for 2011 minus value for 2006 for vars I care about
delta <- dists %>% filter((year == 2006) | (year == 2011)) %>% 
  group_by(State, District) %>% 
  mutate_at(vars, first_diff) %>% filter(year == 2011)

# 

for (d in c("levels", "delta")) {
  for (v in vars) {
    df<- get(d)
    g <- ggplot(df, aes(x = state_abbr, y = .data[[v]], color = state_abbr)) +
    geom_violin() + geom_point(size = 1, alpha = .5, position = position_jitter(.1)) +
    theme(legend.position = "none") + labs(title = paste(v, d, sep = ", "))
    print(g)  
  }
}
```


